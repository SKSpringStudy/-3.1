# 2.3 개발자를 위한 테스팅 프레임워크 JUnit
JUnit 프레임워크에 대해 자세히 알아보자. <br/>

### 포괄적인 테스트
개발자가 테스트를 직접 만들 때 자주 하는 실수 중 하나는 바로 성공하는 테스트만 골라 만드는 것이다. <br/>
스프링의 창시자인 로드 존슨은 **항상 네거티브한 테스트를 먼저 만들어라.** 라는 말을 했다. <br/>
따라서 테스트를 만들 때는 예외적인 상황을 생각하고 부정적인 케이스를 먼저 만드는 습관을 들이는 것이 좋다. <br/>

### TDD
TDD란 `Test Driven Development`의 약자로, 테스트를 코드보다 먼저 작성하는 방법이다. <br/>
"실패한 테스트를 성공시키기 위한 목적이 아닌 코드는 만들지 않는다"라는 기본 원칙을 바탕으로, TDD를 따른 모든 코드는 빠짐없이 테스트로 검증된 것이라 볼 수 있다. <br/>

TDD는 아예 테스트를 먼저 만들고 그 테스트가 성공하도록 하는 코드만 만드는 식으로 진행하기 때문에 테스트를 빼먹지 않고 꼼꼼하게 만들어낼 수 있다. 또한 TDD는 코드에 대한 피드백을 매우 빠르게 받을 수 있도록 한다. <br/>
게다가 매번 테스트가 성공하는 것을 보면서 작성한 코드에 대한 확신을 가질 수 있어, 가벼운 마음으로 다음 단계로 넘어갈 수 있다. <br/>

### 픽스처
테스트를 수행하는데 필요한 정보나 오브젝트를 `픽스처`라고 한다. <br/>
일반적으로 픽스처는 여러 테스트에서 반복적으로 사용되기 때문에 `@Before`를 통해 미리 생성해두면 편리하다. <br/>


# 2.4 스프링 테스트 적용
스프링으로 테스트를 하게 되면 지금까지의 테스트 코드에 문제가 있다.
1. `ApplicationContext`를 테스트 메서드만큼 생성하게 되면 빈이 많아지고 복잡해지면 애플리케이션 컨텍스트 생성이 오래 걸릴 수 있다.
2. 빈의 초기화 과정에서 할당한 리소스 등을 깔끔하게 정리해주지 않으면 리소스의 낭비가 발생할 수 있다.

### 2.4.1 테스트를 위한 애플리케이션 컨텍스트 관리
`@RunWith(JUnit 버전)`
- JUnit이 테스트를 진행하는 중에 테스트가 사용할 애플리케이션 컨텍스트를 만들고 관리하는 작업을 진행해준다.

`@Autowired`
- 스프링의 DI를 위한 특별한 애너테이션이다.
- 이것이 붙은 인스턴스 변수가 있으면 테스트 컨텍스트 프레임워크가 변수 타입과 일치하는 빈을 찾아준다. 타입이 일치하는 빈이 있으면 인스턴스 변수에 주입해준다.
- 일반적으로 DI를 위해서는 생성자나 수정자 메서드같은 메서드가 필요하지만, 이 경우에는 메서드가 없어도 주입이 가능하다.

### 2.4.2 DI와 테스트

#### **인터페이스를 두고 DI를 적용해야 하는 이유**
1. 소프트웨어 개발에서 절대로 바뀌지 않는 것은 없다.
  - 당장에는 클래스를 바꿔서 사용할 계획이 없다고 하더라고, 언젠가 변경이 필요한 상황이 발생한다면 new를 이용해 생성하는 것보다 DI를 통해 주입받게 하는 것이 훨씬 간편하다.
2. 클래스의 구현 방식은 바뀌지 않더라도 인터페이스를 두고 DI를 적용하게 두면 다른 차원의 서비스 기능을 도입할 수 있다.
  - 새로운 기능이나 부가 기능 등을 간단히 수정/제거 할 수 있다.
  - 스프링은 이런 기법을 일반화해서 AOP라는 기술을 만들었다. (6장에서 자세히)
3. 효율적인 테스트를 할 수 있다.
  - DI는 테스트가 작은 단위의 대상에 대해 독립적으로 만들어지고 실행되게 하는데 중요한 역할을 한다.

#### **DI를 이용한 테스트 방법 선택**
1. 항상 스프링 컨테이너 없이 테스트할 수 있는 방법을 가장 우선적으로 고려하자.
  - 테스트를 위해 필요한 오브젝트의 생성과 초기화가 단순하다면 이 방법을 가장 먼저 고려해야 한다.
2. 스프링의 설정을 이용한 DI 방식의 테스트를 이용해도 편리하다.
  - 여러 오브젝트와 복잡한 의존관계를 가지고 있는 오브젝트를 테스트해야 한다면 이 경우를 사용하자.
  - 테스트 전용 설정파일을 따로 만들어 사용하는 편이 좋다.
  - 보통 개발환경과 테스트환경, 운영환경이 차이가 있기 때문에 각각 다른 설정파일을 만들어 사용하는 경우가 일반적이다.
3. 예외적인 의존관계를 강제로 구성해서 테스트해야 하는 경우
  - 컨텍스트에서 DI받은 오브젝트에 다시 테스트코드로 수동 DI해서 사용한다. (테스트 메서드나 클래스에 `@DirtiesContext`)

# 2.5 학습 테스트
자신이 만들지 않는 프레임워크나 다른 개발팀에서 만들어서 제공한 라이브러리 등에 대해서 작성하는 테스트이다. <br/>

학습 테스트의 목적은 자신이 사용할 API나 프레임워크의 기능을 테스트로 보면서 사용 방법을 익히려는 것이다. <br/>
테스트이지만 프레임워크나 기능에 대한 검증이 목적이 아니다. 자신이 테스트를 만들려고 하는 기술이나 기능에 대해 얼마나 제대로 이해하고 있는지, 그 사용 방법을 바로 알고 있는지를 검증하려는 게 목적이다. <br/>

### 2.5.1 학습 테스트의 장점
1. 다양한 조건에 따른 기능을 손쉽게 확인해볼 수 있다.
2. 학습 테스트코드를 개발 중에 참고할 수 있다.
3. 프레임워크나 제품을 업그레이드할 때 호환성 검증을 도와준다.
4. 테스트 작성에 대한 좋은 훈련이 된다.

### 2.5.3 버그 테스트
오류가 있을 때 그 오류를 가장 잘 드러내줄 수 있는 테스트를 말한다. <br/>
버그 테스트는 일단 실패하도록 만들어야 한다. 버그가 원인이 돼서 테스트가 실패하는 코드를 만드는 것이다. 그리고 버그 테스트가 성공할 수 있게 애플리케이션 코드를 수정한다.

#### **버그 테스트의 장점**
1. 테스트의 완성도를 높여준다.
2. 버그의 내용을 명확하게 분석하게 해준다.
3. 기술적인 문제를 해결하는데 도움이 된다.
